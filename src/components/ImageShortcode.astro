---
export interface Props {
  src: string;
  alt?: string;
  width?: number;
  height?: number;
}

const { src, alt = '', width, height } = Astro.props;

// Import all images from the assets folder eagerly so they can be looked up by
// filename at runtime. This allows markdown shortcodes to reference any image
// without updating this component each time.
const imageMap = import.meta.glob('../../assets/images/**/*', {
  eager: true,
  import: 'default',
});

function resolveImage(path: string) {
  const normalized = path.replace(/^\/?/, '');
  for (const [key, mod] of Object.entries(imageMap)) {
    if (key.endsWith(normalized)) return mod as unknown as string;
  }
  return undefined;
}

const imageSrc = resolveImage(src);

import { Image } from 'astro:assets';
---

{imageSrc ? (
  <Image src={imageSrc} alt={alt} width={width} height={height} />
) : (
  <div class="bg-yellow-500 text-black p-2">
    <p>⚠️ Image not found for <strong>{src}</strong></p>
  </div>
)}
